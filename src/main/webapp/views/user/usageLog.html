<div class="row" ng-switch="isEditable">
	<div class="col-md-12">
		<div class="usage-log" ng-show="readOnly">
		 
			 <h4>Submitted Commercial Usage Report</h4>
			 <hr>
			  <p class="bg-info" ng-switch-when="true">
			  	<span class="pull-right" id="retractBtn" ng-show="isActiveUsage"><button ng-disabled="!readOnly" ng-click="retractUsageReport()" class="btn btn-danger">Retract Declaration </button></span>
			  	<span class="pull-right" ng-hide="isActiveUsage"><span class="label label-default">Usage Report Superseded</span></span>
				<strong>Commercial Usage for: {{commercialUsageReport.startDate | date : 'MMM'}} - {{commercialUsageReport.endDate | date : 'MMM yyyy'}} was submitted: {{commercialUsageReport.submitted | date }} </strong>
			</p>
		</div>
	
		<div class="panel panel-default" >
	      <div class="panel-heading">
	        <h4 class="panel-title">
	        	Licence Usage
	        	<span class="pull-right">{{commercialUsageReport.startDate | date : 'MMM'}} - {{commercialUsageReport.endDate | date : 'MMM yyyy'}}</span>
	        </h4>
	        <p ng-show="isAffiliateApplying">Please fill out any known usage information at this time, you will be asked to confirm usage once your application is approved.</p>
	      </div>
	      <div class="panel-body panel-collapse collapse in">
	       <ng-form name="usageForm" novalidate bs-validation >
	                 <div class="form-group" ng-init="affilliateControllerSharedBucket.usageForm = usageForm">
	                    <label>Licence Type: </label> <span>{{commercialUsageReport.type | enum:'affiliate.type.'}}</span>
	                  </div>
	                  <div class="form-group">
	                    <label>Current Usage:</label>
	                    <textarea class="form-control" rows="3" required ng-disabled="readOnly" name="currentUsage" ng-model="commercialUsageReport.context.currentUsage" auto-submit></textarea>
	                    <div ng-show="usageForm.attempted">
							<p ng-show="usageForm.currentUsage.$error.required" class="help-block">Required field.</p>
						</div>
	                  </div>
	                  <div class="form-group">
	                    <label>Planned Usage:</label>
	                    <textarea class="form-control" rows="3" required  ng-disabled="readOnly" name="plannedUsage" ng-model="commercialUsageReport.context.plannedUsage" auto-submit></textarea>
	                    <div ng-show="usageForm.attempted">
							<p ng-show="usageForm.plannedUsage.$error.required" class="help-block">Required field.</p>
						</div>
	                  </div>
	                  <div class="form-group">
	                    <label>Purpose:</label>
	                    <textarea class="form-control" rows="3" required  ng-disabled="readOnly" name="purpose" ng-model="commercialUsageReport.context.purpose" auto-submit></textarea>
	                    <div ng-show="usageForm.attempted">
							<p ng-show="usageForm.purpose.$error.required" class="help-block">Required field.</p>
						</div>
	                  </div>
	                  <div class="form-group">
	                    <label>Implementation Status:</label>
	                    <select name="implementationStatus" class="form-control" required ng-disabled="readOnly" ng-model="commercialUsageReport.context.implementationStatus" ng-options="status | enum:'affiliate.implementationStatus.' for status in implementationStatusOptions"  auto-submit>
	                    </select> 
	                    <div ng-show="usageForm.attempted">
							<p ng-show="usageForm.implementationStatus.$error.required" class="help-block">Required field.</p>
						</div>
	                  </div>
	       </ng-form>
			</div>
		</div>
	
    <div class="panel panel-default"  ng-hide="readOnly && commercialType">
      <div class="panel-heading">
        <h4 class="panel-title">
          Countries in Use
        </h4>
      </div>
      <div class="panel-body panel-collapse collapse in">
      	  <alert ng-repeat="alert in geographicAlerts" type="{{alert.type}}" close="closeAlert($index)">{{alert.msg}}</alert>
        <p>
          <strong>Select the countries in which SNOMED CT will be used</strong>
        </p>
         <form name="usageLogCountries">
           <div class="col-sx-4 col-md-4 col-lg-6" ng-hide="readOnly">
             <h4>List of Countries</h4>
             <div class="selectpicker">
               <div class="input-group">
                 <input class="form-control" type="search" ng-model="q" placeholder="Search Countries" /> <span class="input-group-addon"><span class="fa fa-search"></span> </span>
               </div>
               <div class="form-group">
                 <select name="countries" multiple ng-model="selectedCountryCodesToAdd" class="form-control">
                   <option ng-repeat="country in availableCountries | filter:q" value="{{country.isoCode2}}">{{country.commonName}}</option>
                 </select>
               </div>
               <div class="form-group">
               	<button class="btn btn-success" ng-disabled="!canAddSelectedCountries(selectedCountryCodesToAdd)" ng-click="addSelectedCountries(selectedCountryCodesToAdd)">
               		<i class="fa fa-plus"></i> Add Country
               		<span ng-show="geographicAdding"><i class="fa fa-spinner"></i></span>
               	</button>
               </div>
             </div>
           </div>
           <div class="col-sx-4 col-md-4 col-lg-6">
           	<h4>Home Country: <span>{{homeCountry.commonName}}</span></h4>
           </div>
           
				</form>
      </div>
    </div>
    
		<div class="panel panel-default">
			<div class="panel-heading">
				<h4 class="panel-title">
					Sublicensed Institutions
				</h4>
			</div>
			<div class="panel-body" >
				<div ng-show="usageByCountryList.length == 0 && !readOnly">A country needs to be selected before entering Sublicensed Institutions.</div>
				<div ng-show="usageByCountryList.length == 0 && readOnly">No countries have been selected.</div>
				<div class="country-listing" ng-repeat="countryUsage in usageByCountryList">
            <div class="row">
                    <div class="country-heading">
                          <div class="col-xs-8 col-sm-6 col-md-4 col-lg-6">
                             <h3 class="country-title">{{countryUsage.country.commonName}}</h3>
                          </div>
                         <div class="col-xs-4 col-sm-6  col-md-8 col-lg-6" ng-hide="readOnly">
                          <div class="form-group pull-right">
                            <a class="btn btn-danger btn-xs" ng-click="removeCountryModal(countryUsage.count)"><i class="fa fa-times"></i> Remove Country</a>
                          </div>
                        </div>
                  </div>
					</div>
					<div class="country-section">
						<hr>
						<div class="row">
							<div class="col-xs-8">
								<h4>Hospital(s)/Institution(s)</h4>
							</div>
							<div class="col-xs-4" ng-hide="readOnly">
	              <div class="form-group pull-right">
	                <a class="btn btn-success btn-xs" ng-click="addInstitutionModal(countryUsage.country)"><i class="fa fa-plus"></i> Add Hospital/Institution</a>
	              </div>
							</div>
						</div>
					</div>
					<div class="row">
					<table class="table table-striped">
						<tr>
							<th class="text-left col-md-2">Name</th>
							<th class="text-left col-md-2">Started to Use</th>
							<th class="text-left col-md-2">Ceased Use</th>
							<th class="text-left col-md-5">Note</th>
							<th class="col-md-1"></th>
						</tr>

						<tr ng-repeat="institution in countryUsage.entries">
							<td class="col-md-2">{{institution.name}}</td>
							<td class="col-md-2">{{institution.startDate | date}}</td>
							<td class="col-md-2">{{institution.endDate | date}}
								<span ng-show="institutionDateRangeOutsidePeriod(institution)">
									<span tooltip-placement="top" tooltip="Consider removing this hospital as it ceased use prior to the current declaration period">
										<span class="label label-warning">Outdated</span>
									</span>
								</span>
							</td>
							<td class="col-md-5">{{institution.note}}</td>
							<td class="col-md-1">
								<div class="btn-group" dropdown ng-hide="readOnly">
									<button type="button" class="btn btn-primary btn-xs dropdown-toggle" data-toggle="dropdown"> <i class="fa fa-pencil"></i> Edit</button>
									<ul class="dropdown-menu dropdown-menu-right" role="menu">
										<li><a ng-click="editInstitutionModal(institution, countryUsage.country)">Edit Hospital/Institution</a></li>
										<li class="divider"></li>
										<li><a ng-click="deleteInstitutionModal(institution, countryUsage.country)">Remove Hospital/Institution</a></li>
									</ul>
								</div>
							</td>
						</tr>
					</table>
				</div>
				<div class="country-section">
					<hr>
					<div class="row">
						<div class="col-xs-8">
							<h4>Practice(s)</h4>
						</div>
						<div class="col-xs-4">
              <button ng-hide="readOnly" type="button" class="btn btn-primary btn-xs pull-right" ng-click="editCountModal(countryUsage.count)"> <i class="fa fa-pencil"></i> Edit Practices</button>
						</div>
					</div>
				</div>
        <div class="row">
          <div class="country-footer">
            <div class="col-xs-12">
              <p>
              	<strong>Practices: </strong> 
              	<span class="label label-default">{{countryUsage.count.snomedPractices | number}}</span>
              </p>
            </div>
          </div>
        </div>
        <div class="row" ng-show="countryUsage.count.notes">
          <div class="country-footer">
            <div class="col-xs-12">
             	<label>Notes: </label> 
              <p>
              	{{countryUsage.count.notes}}
              </p>
            </div>
          </div>
        </div>
				<div class="country-section">
					<hr>
					<div class="row">
						<div class="col-xs-8">
							<h4>Data Analysis</h4>
						</div>
						<div class="col-xs-4">
              <button ng-hide="readOnly" type="button" class="btn btn-primary btn-xs pull-right" ng-click="editCountDataAalysisModal(countryUsage.count)"> <i class="fa fa-pencil"></i> Edit Data Analysis</button>
						</div>
					</div>
				</div>
        <div class="row">
          <div class="country-footer">
            <div class="col-xs-12">
             	<p><strong>Hospitals providing staff to practices:</strong> <span class="label label-default">{{countryUsage.count.hospitalsStaffingPractices | number}}</span></p> 
             	<p><strong>Data Creation Systems: Independent practices:</strong> <span class="label label-default">{{countryUsage.count.dataCreationPracticesNotPartOfHospital | number}}</span> <strong>Non-practices:</strong> <span class="label label-default">{{countryUsage.count.nonPracticeDataCreationSystems | number}}</span></p> 
             	<p><strong>Data Analysis Systems: Systems:</strong> <span class="label label-default">{{countryUsage.count.deployedDataAnalysisSystems | number}}</span> <strong>Data:</strong> <span class="label label-default">{{countryUsage.count.databasesPerDeployment | number}}</span></p> 
            </div>
          </div>
        </div>
      </div>

		</div>
	</div>
	<div class="panel panel-default" ng-show="commercialType">
		<div class="panel-heading">
			<h4 class="panel-title">
				Other Activities
			</h4>
		</div>
		<div class="panel-body" >
			<ng-form name="usageForm" novalidate bs-validation >
				<p>Affiliates are required to notify IHTSDO prior to engaging in any activities that do not fall within the existing categories at which time the IHTSDO will determine the appropriate Fee Structure for the activity in question.</p>
				<p>Please describe activity below.</p>
				<div class="form-group">
					<textarea rows="4" class="form-control" name="otherActivities" ng-model="commercialUsageReport.context.otherActivities" ng-disabled="readOnly" auto-submit></textarea>
				</div>
			</ng-form>
		</div>
	</div>
	
  <div class="space"></div>
</div>
</div>

<div class="row">
	<div class="col-xs-offset-1 col-sm-offset-0 col-md-offset-0 col-md-12">
		<div class="submit-usage" ng-hide="readOnly || !canSubmit">
			<button ng-click="submitUsageReport(usageForm)" type="button" class="btn btn-success btn-large">Submit Declaration for {{commercialUsageReport.startDate | date : 'MMM'}} - {{commercialUsageReport.endDate | date : 'MMM yyyy'}}</button> 
			<div ng-show="usageForm.attempted" class="has-error">
				<p ng-show="usageForm.$invalid" class="help-block">Please fix the errors listed above.</p>
			</div>
		</div>
  </div>
</div>
