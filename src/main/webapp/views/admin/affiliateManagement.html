<div class="row">
	<div class="col-md-12">
		<div class="page-header">
			<h2>Affiliate Management</h2>
			<div ng-show="isAdmin">
				<span>Show: </span>
				<select ng-model="showAllAffiliates">
					<option value="0" selected="selected">My Affiliates</option>
					<option value="1">All Affiliates</option>
				</select>
			</div>
		</div>
	</div>
</div>
<div class="row">
	<div class="col-sm-6">
		<div class="input-group">
      <input class="form-control" type="search" ng-model="query" placeholder="Search Affiliates"> 
     	<span class="input-group-addon"><span class="fa fa-search"></span></span>
    </div>
    <hr>
	</div>
	<div class="col-sm-2">
  		<button class="btn btn-info btn-muted" ng-click="query = ''">Clear</button>
  	</div>
  	<div class="col-sm-2 text-right">
  		Standing State:
  	</div>
  	<div class="col-sm-2">
		<select class="form-control input-md"
       		name="standingStateFilter"
			required
			ng-model="standingStateFilter"
			ng-options="standingState | enum:'affiliate.standingState.' for standingState in standingStateOptions"
			>
			<option>
		</select>
  	</div>
</div>

<div class="row">
	<div class="col-sm-12">
		  <div ng-show='!noResults && query'>Search results</div>
		  <alert ng-repeat="alert in alerts" type="{{alert.type}}" close="closeAlert($index)">{{alert.msg}}</alert>
			<table class="table table-hover">
				<thead>
					<tr>
						<th>
							<span ng-show="canSort">
								<a ng-click="toggleField('affiliateId')">
									No.
									<span ng-show="orderByField == 'affiliateId'">
										<span ng-show="!reverseSort"><i class="fa fa-sort-asc"></i></span>
										<span ng-show="reverseSort"><i class="fa fa-sort-desc"></i></span>
									</span>
								</a>
							</span>
							<span ng-hide="canSort">
								No.
							</span>
						</th>
						<th>
							<span ng-show="canSort">
								<a ng-click="toggleField('name')">
									Affiliate Name
									<span ng-show="orderByField == 'name'">
										<span ng-show="!reverseSort"><i class="fa fa-sort-asc"></i></span>
										<span ng-show="reverseSort"><i class="fa fa-sort-desc"></i></span>
									</span>
								</a>
							</span>
							<span ng-hide="canSort">
								Affiliate Name
							</span>
						</th>
						<th>
							<span ng-show="canSort">
								<a ng-click="toggleField('agreementType')">
									Agreement Type
									<span ng-show="orderByField == 'agreementType'">
										<span ng-show="!reverseSort"><i class="fa fa-sort-asc"></i></span>
										<span ng-show="reverseSort"><i class="fa fa-sort-desc"></i></span>
									</span>
								</a>
							</span>
							<span ng-hide="canSort">
								Agreement Type
							</span>
						</th>
						<th>
							<span ng-show="canSort">
								<a ng-click="toggleField('standingState')">
									Standing
									<span ng-show="orderByField == 'standingState'">
										<span ng-show="!reverseSort"><i class="fa fa-sort-asc"></i></span>
										<span ng-show="reverseSort"><i class="fa fa-sort-desc"></i></span>
									</span>
								</a>
							</span>
							<span ng-hide="canSort">
								Standing
							</span>
						</th>
						<th>
							<span ng-show="canSort">
								<a ng-click="toggleField('homeCountry')">
									Home Country
									<span ng-show="orderByField == 'homeCountry'">
										<span ng-show="!reverseSort"><i class="fa fa-sort-asc"></i></span>
										<span ng-show="reverseSort"><i class="fa fa-sort-desc"></i></span>
									</span>
								</a>
							</span>
							<span ng-hide="canSort">
								Home Country
							</span>
						</th>
						<th>
							<span ng-show="canSort">
								<a ng-click="toggleField('member')">
									Member
									<span ng-show="orderByField == 'member'">
										<span ng-show="!reverseSort"><i class="fa fa-sort-asc"></i></span>
										<span ng-show="reverseSort"><i class="fa fa-sort-desc"></i></span>
									</span>
								</a>
							</span>
							<span ng-hide="canSort">
								Member
							</span>
						</th>
						<th>
							<span ng-show="canSort">
								<a ng-click="toggleField('email')">
									Email
									<span ng-show="orderByField == 'email'">
										<span ng-show="!reverseSort"><i class="fa fa-sort-asc"></i></span>
										<span ng-show="reverseSort"><i class="fa fa-sort-desc"></i></span>
									</span>
								</a>
							</span>
							<span ng-hide="canSort">
								Email
							</span>
						</th>
						<th></th>
					</tr>
				</thead>
				<tbody infinite-scroll="nextPage()" infinite-scroll-distance="1" infinite-scroll-disabled="downloadingAffiliates">
					<tr ng-click="viewAffiliate(affiliate.affiliateId)" ng-repeat="affiliate in affiliates">
						<td>{{affiliate.affiliateId}}</td>
						<td>{{affiliateActiveDetails(affiliate).firstName + ' '+affiliateActiveDetails(affiliate).lastName}}</td>
						<td>{{affiliateActiveDetails(affiliate).type | enum:'affiliate.type.'}} - {{affiliateActiveDetails(affiliate).subType | enum:'affiliate.subType.'}} {{affiliateActiveDetails(affiliate).otherText}}</td>
						<td>{{affiliate.standingState | enum:'affiliate.standingState.'}}</td>
						<td>{{affiliateActiveDetails(affiliate).address.country.commonName}}</td>
						<td>{{affiliate.homeMember.key}}</td>
						<td><a href="mailto:{{affiliate.affiliateDetails.email}}">{{affiliateActiveDetails(affiliate).email}}</a></td>
						<td> <a class="btn btn-primary btn-sm" ng-click="viewAffiliate(affiliate.affiliateId)"><i class="fa fa-eye"></i> View Affiliate</a></td>
					</tr>
				</tbody>
			</table>
			<div ng-show='downloadingAffiliates' class="text-center"><i class="fa fa-spinner"></i> Loading data...</div>
			<div ng-show='noResults && !downloadingAffiliates'>No results.</div>
	</div>
</div>